{% extends "MetricsBundle::templates/default-widget.html.twig" %}

{% block widget_body %}
    <div id="chart-{{ widget.id }}" style="height: 120px; top: -7px"></div>
{% endblock %}

{% block script %}
    <script>
        // HERE YOU CAN GET YOUR WIDGET DATA
        addDataRequest(
                '{{ path('JiraHistoryWidgetBundle-collect-data') }}',
                {id:{{ widget.id }}, type:'{{ widget.type }}', updateInterval:'{{ widget.updateInterval }}'},
                function (data) {
                    var response = JSON.parse(data);

                    $('#chart-{{ widget.id }}').html('');

                    if (response['warning']) {
                        $('#chart-{{ widget.id }}').html(response['warning']);
                        return;
                    }

                    new Morris.Area({
                        element: 'chart-{{ widget.id }}',
                        hideHover: 'auto',
                        data: response['data1'],
                        xkey: 'date',
                        ykeys: ['value'],
                        parseTime: false,
                        labels: [response['label1']],
                        fillOpacity: 0.5
                    });

                    if (response['need-update']) {
                        dataRequestHandler.retryQueue.push(
                            {
                                'url':'{{ path('JiraHistoryWidgetBundle-collect-data') }}',
                                'params': {id:{{ widget.id }}, type:'{{ widget.type }}', updateInterval:'{{ widget.updateInterval }}'},
                                'callback': arguments.callee
                            }
                        );
                    }
                }
        );
    </script>
{% endblock %}