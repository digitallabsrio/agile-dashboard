{% extends "MetricsBundle::layout.html.twig" %}

{% block content %}
    <script>
        var requestStack = [];
        function addDataRequest(url, params, callback) {
            requestStack.push({'url':url, 'params': params, 'callback': callback});
        }
    </script>

    {% if widgets|length %}
        {% for widget in widgets %}
            {% include 'MetricsBundle::' ~ widget.type ~ '.html.twig' with {'widget': widget} %}
        {% endfor %}
    {% endif %}

{% endblock %}

{% block js %}
    <script>
        $(document).ready(function() {
            refreshWidgetData();
            var updateTimer = window.setInterval(function(){refreshWidgetData()}, {{ interval }} * 60000 );
        });

        function refreshWidgetData()
        {
            for (var i = 0; i < requestStack.length; i++) {
                var request = requestStack[i];
                $.post(request['url'], request['params'], request['callback']);
            }
        }
    </script>
{% endblock %}
